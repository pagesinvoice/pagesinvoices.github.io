<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=60mm, initial-scale=1.0" />
    <title>Ticket de Compra</title>
    <style>
      body {
        font-family: tahoma, Helvetica, sans-serif;
        margin: 0;
        font-size: 3mm;
        text-align: center; /* Centrar todo el contenido */
      }

      #thermal-pos {
        margin: none;
        max-width: 60mm;
      }

      .label {
        margin: 0;
        margin-left: 0.5mm;
      }

      .table {
        border-collapse: collapse; /* Elimina el espacio entre celdas */
        border-collapse: collapse;
        border-spacing: 0;
        width: 100%; /* Ensure tables take full width */
      }

      .table th,
      .table td {
        padding: 1mm; /* Add some padding to table cells */
        text-align: left; /* Align text to the left */
      }

      .table-header h2 {
        margin: 0;
        padding-left: 0.5mm;
      }
      .table-footer.top-line td,
      .table-footer {
        margin-left: 0.5mm;
      }
      .table-footer h2 {
        margin: 0; /* Asegurarte de que no haya margen dentro de los elementos h2 */
        padding: 1mm 0; /* Ajustar el padding superior e inferior */
      }
      .table-footer h4 {
        margin: 0; /* Asegurarte de que no haya margen dentro de los elementos h2 */
        padding: 1mm 0; /* Ajustar el padding superior e inferior */
      }
      .saldo-text {
        margin: 0;
        margin-left: 0.1mm;
      }

      .policy {
        margin-left: 0.5mm;
      }

      /* Agrega el estilo para eliminar el espacio vertical en las celdas de las filas de la tabla */
      .table-footer td {
        padding: 0;
        line-height: 1;
      }
      .nro_boleta {
        margin: 0;
        padding: 0;
      }
      .nro_mesa {
        margin: 0;
      }
      .fecha_recepcion {
        margin: 0;
      }

      .info-tienda {
        margin: 0;
      }
      .m-0 {
        margin: 0;
      }
      .direccion {
        margin: 0;
      }

      .section-title {
        text-align: center;
        margin-top: 5mm;
        margin-bottom: 2mm;
        font-size: 3.5mm;
        font-weight: bold;
      }

      .note-container {
        text-align: center;
        margin-top: 5mm;
        font-size: 3.5mm;
        font-weight: bold;
        /* Added styles to center the block element */
        display: block;
        margin: 5mm auto 0 auto; /* Centers the block horizontally */
      }
    </style>
  </head>
  <body onload="window.print()" onfocus="window.close()">
    <script>
      // Obtener los parámetros de la URL
      const params = new URLSearchParams(window.location.search);

      // Obtener los valores de los parámetros
      var nro_boleta = params.has("boleta") ? params.get("boleta") : "---";
      var nro_mesa = params.has("mesa") ? params.get("mesa") : "---";
      var direc = params.has("direccion") ? params.get("direccion") : "---";

      var fecha = params.has("fecha")
        ? params.get("fecha")
        : "dd/mm/aaaa hh:mm:ss";
      var fecha_entrega = params.has("fecha_entrega")
        ? params.get("fecha_entrega")
        : "hh:mm:ss";
      var domi = params.has("domi") ? params.get("domi") : "N/A";
      var propina = params.has("propina") ? params.get("propina") : "N/A";

      var total = params.has("total") ? params.get("total") : "";
      var subtotal_desc = params.has("subtotal_desc")
        ? params.get("subtotal_desc")
        : " ";
      var descuento = params.has("descuento") ? params.get("descuento") : " ";
      var estado = params.has("estado") ? params.get("estado") : "--";

      //Recibe los datos de los servicios (separados por comas)
      var cantidades = params.has("cantidades")
        ? params.get("cantidades")
        : "0";
      var descripciones = params.has("servicios")
        ? params.get("servicios")
        : "No hay articulos";
      var p_units = params.has("p_unit") ? params.get("p_unit") : "0.00";

      //Formato de 2 decimales
      propina = parseFloat(propina).toLocaleString("es-ES", {
        minimumFractionDigits: 0,
      });
      domi = parseFloat(domi).toLocaleString("es-ES", {
        minimumFractionDigits: 0,
      });
      total = parseFloat(total).toLocaleString("es-ES", {
        minimumFractionDigits: 0,
      });
      descuento = parseFloat(descuento).toLocaleString("es-ES", {
        minimumFractionDigits: 0,
      });
      subtotal_desc = parseFloat(subtotal_desc).toLocaleString("es-ES", {
        minimumFractionDigits: 0,
      });

      //crea una lista de cada columna a partir de las comas.
      cantidades = cantidades.split(",");
      descripciones = descripciones.split(",");
      p_units = p_units.split(",");

      //Crea una lista para mostrar en cada fila de la tabla
      var result = [];

      cantidades.forEach(function (value, id) {
        result[id] = {
          cantidad: cantidades[id],
          descripcion: descripciones[id], // + " " + detalles[id], // Descomenta si deseas concatenar la descripción con el detalle
          precio_unit: parseFloat(p_units[id]).toLocaleString("es-ES", {
            minimumFractionDigits: 0,
          }),
        };
      });
    </script>
    <div id="thermal-pos">
      <div class="label">
        <br />
        <br />
        <p class="info-tienda">
          Nit:
          <br />
          Domicilios 304 4430427 / Mistares Etapa 2 Frente Bourboun
          <br />
        </p>
      </div>

      <div class="label">
        <b>TICKET:</b>
        <h1 class="nro_boleta" id="nro_boleta_id"></h1>
        <h1 class="nro_mesa" id="nro_mesa_id"></h1>
        <h3 class="direccion" id="nro_direccion_id"></h3>
      </div>
      <div class="label">
        <p class="fecha_recepcion">
          FECHA DE RECEPCION:
          <br />
          <b id="fechaR"></b>
          <b span id="hora"></b>
        </p>
      </div>

      <table class="table">
        <tbody id="tablaBody">
          <tr class="table-header">
            <th><h2>Cant</h2></th>
            <th><h2>Producto</h2></th>
            <th><h2>Total</h2></th>
          </tr>
          <script>
            /*var result = [
                        { cantidad: 3, descripcion: "hamburguesa doble carne", precio_unit: 10000 },
                        { cantidad: 5, descripcion: "Perro mas gaseosa y de todo", precio_unit: 20000 },
                        // ... otros objetos en el array
                    ];*/

            var tablaBody = document.getElementById("tablaBody");

            result.forEach(function (row) {
              var newRow = document.createElement("tr");
              newRow.className = "table-item";

              newRow.innerHTML = `
                        <td class="item">${row.cantidad}</td>
                        <td class="item">${row.descripcion}</td>
                        <td class="item">${row.precio_unit}</td>
                    `;
              tablaBody.appendChild(newRow);
            });
            // Agrega una fila adicional con un espacio
            var spaceRow = document.createElement("tr");
            spaceRow.innerHTML = `<td colspan="3">&nbsp;</td>`;
            tablaBody.appendChild(spaceRow);
          </script>
        </tbody>
      </table>

      <div class="section-title">COMO SE FACTURA</div>
      <table class="table">
        <thead>
          <tr>
            <th><h2>Cant</h2></th>
            <th><h2>Producto</h2></th>
            <th><h2>Precio</h2></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>

      <table class="table">
        <tbody class="table-footer">
          <tr>
            <td colspan="2"><h2>EFECTIVO:</h2></td>
            <td colspan="2"><h2 id="efectivo"></h2></td>
          </tr>
          <tr class="top-line">
            <td class="" colspan="2"><h2>TOTAL:</h2></td>
            <td colspan="2"><h2 id="total"></h2></td>
          </tr>
          <tr>
            <td colspan="2"><h2>DEVUELTAS:</h2></td>
            <td colspan="2"><h2 id="devueltas"></h2></td>
          </tr>
        </tbody>
      </table>
      <div class="section-title">MATERIAS PRIMAS</div>
      <table class="table">
        <thead>
          <tr>
            <th><h2>Cant</h2></th>
            <th><h2>Producto</h2></th>
            <th><h2>Total</h2></th>
          </tr>
        </thead>

        <tbody>
          <tr>
            <td></td>
            <td></td>
            <td></td>
          </tr>
        </tbody>
      </table>

      <div class="section-title">PROGRAMACION</div>
      <table class="table">
        <tbody>
          <tr>
            <td>FECHA DE CARGUE</td>
            <td></td>
          </tr>
          <tr>
            <td>HORA DE CARGUE</td>
            <td></td>
          </tr>
          <tr>
            <td>VEHICULO</td>
            <td></td>
          </tr>
          <tr>
            <td>CONDUCTOR</td>
            <td></td>
          </tr>
          <tr>
            <td>HORA DE ENTREGA</td>
            <td></td>
          </tr>
        </tbody>
      </table>

      <br />
      <p class="saldo-text">
        <b><span class="estado-deuda" id="estado"></span></b>
      </p>
      <div class="note-container">NOTA</div>
    </div>

    <script>
      var nroBoletaElement = (document.getElementById(
        "nro_boleta_id"
      ).textContent = nro_boleta);
      var nroMesaElement = (document.getElementById("nro_mesa_id").textContent =
        nro_mesa);
      var nroDireccion = (document.getElementById(
        "nro_direccion_id"
      ).textContent = direc);

      var fechaElement = (document.getElementById("fechaR").textContent =
        fecha);
      var fecha_entregaElement = (document.getElementById("hora").textContent =
        fecha_entrega);

      /*const propinaCell = document.getElementById("propinaCell");
        var propinaElement = document.getElementById("propina");
                    // Verifica si domi es igual a "N/A"
            if (propina == "NaN") {
                    // Si domi es "N/A", oculta el elemento <td> que contiene la etiqueta y el valor
                propinaCell.style.display = "none";
            } else {
             // Si domi no es "N/A", muestra el valor en el elemento <h2>
             propinaElement.textContent = propina;
            }

        const domicilioCell = document.getElementById("domicilioCell");
        var domiElement = document.getElementById("domi");
                    // Verifica si domi es igual a "N/A"
            if (domi == "NaN") {
                    // Si domi es "N/A", oculta el elemento <td> que contiene la etiqueta y el valor
                domicilioCell.style.display = "none";
            } else {
             // Si domi no es "N/A", muestra el valor en el elemento <h2>
             domiElement.textContent = domi;
            }       */
      var totalElement = (document.getElementById("total").textContent = total);
      var subtotal_descElement = (document.getElementById(
        "efectivo"
      ).textContent = descuento);
      var descuentoElement = (document.getElementById("devueltas").textContent =
        subtotal_desc);
      var estadoElement = (document.getElementById("estado").textContent =
        estado);
    </script>
  </body>
</html>
